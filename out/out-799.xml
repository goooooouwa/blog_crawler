<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
<channel>
<title>Coding Horror</title>
<description>programming and human factors</description>
<link>https://blog.codinghorror.com/</link>
<pubDate>Sun, 19 Apr 2020 00:00:01 GMT</pubDate>
<!-- other elements omitted from this example -->
<item>
<title>Sometimes It's a Hardware Problem</title>
<link>https://blog.codinghorror.com/sometimes-its-a-hardware-problem/</link>
<content>
                <!--kg-card-begin: markdown--><p>
One of our best servers at work was inherited from a previous engagement for x64 testing: it's a dual Opteron 250 with 8 gigabytes of RAM. Even after a year of service, those are still decent specs. And it has a nice upgrade path, too: the <a href="http://www.gamepc.com/labs/view_content.asp?id=thunderk8w&amp;page=1">Tyan Thunder K8W</a> motherboard it's based on supports up to 16 gigabytes of memory, and <a href="http://www.tyan.com/support/html/cpu_athlon_duron_opteron.html">the latest dual core Opterons</a>.
</p>
<p>
Anyway, we have it set up for <a href="http://www.microsoft.com/windowsserversystem/virtualserver/default.mspx">Virtual Server 2005 R2 duties</a>, running Windows Server 2003 x64. However, there was some anomalous behavior:
</p>
<p>
</p>
<ul>
<li>Virtual Server reported weird error messages: "Some nodes of this machine do not have local memory. This can cause virtual machines to run with degraded performance".
</li>
<li>The machine spontaneously rebooted during the day and overnight.
</li>
</ul>
<p>
We've used this server for over a year and never experienced anything problematic with it. The weirdness only started with the server's new role.
</p>
<p>
The first thing we did was <b>update the BIOS to the latest version, and make sure we had all the latest x64 chipset and platform drivers installed.</b> This is always a good first troubleshooting step-- it's the hardware equivalent of taking two asprins and calling in the morning. This resolved the "some nodes of this machine do not have local memory" error. However, the machine still spontaneously rebooted overnight, even with the latest BIOS and drivers.
</p>
<p>
At this point I began to suspect a hardware problem. Troubleshooting hardware stability can be difficult. But <b>you can troubleshoot hardware stability quite effectively with the right software: <a href="http://www.memtest.org/">Memtest86+</a> and <a href="http://www.mersenne.org/freesoft.htm">Prime95</a></b>.
</p>
<p>
</p>
<ol>
<li>
<b>Testing memory stability with <a href="http://www.memtest.org/">Memtest86+</a></b>
<p>
We started with Memtest86+ because we already suspected the memory. Memtest86+ isn't the only memory testing diagnostic out there, but it's probably the most well-known. Microsoft also offers their <a href="http://oca.microsoft.com/en/windiag.asp">Windows Memory Diagnostic</a> utility, which works exactly the same way. Memtest86+ is <a href="http://www.memtest.org/#downiso">available in several forms from the Memtest86+ web site</a>. We chose the ISO image, which we burned to CD. Boot from the Memtest86 CD, and it'll kick off the test run.
</p>
<p>
<img alt="A Memtest86+ screenshot" border="0" class="at-xid-6a0120a85dcdae970b0128776fe46b970c" height="400" src="https://blog.codinghorror.com/content/images/uploads/2006/08/6a0120a85dcdae970b0128776fe46b970c-pi.png" width="640">
</p>
<p>
It took about 30-45 minutes to test 4 gigabytes of memory. The progress bar at the top right gives you an indication of how long the test has to run; there are 8 total tests in the standard test run. Beware, because it'll start repeating at test #1 after the first pass!
</p>
<p>
</p>
</li>
<li>
<b>Testing CPU stability with <a href="http://www.mersenne.org/freesoft.htm">Prime95</a></b>
<p>
Prime95 is my single favorite PC stability testing tool. If your PC can't pass an overight Prime95 run, it absolutely, positively has a hardware problem.* Although Prime95 is primarily a CPU test, it can also be a pretty good memory test, too. After downloading it, go to the Options menu and select Torture Test.
</p>
<ol>
<li>If you want to test CPU stability exclusively, choose "Small FFTs".
</li>
<li>If you want to test for CPU stability and memory stability, choose "Blend".
</li>
</ol>
</li>
</ol>
<p>
If you have a Dual (or Quad) CPU machine, you must run multiple instances of Prime95 to load each CPU. The easiest way to do this is to copy the Prime95 folder and run multiple executables, each one from a unique folder. You may want to set CPU affinity on the executables with Task Manager, but the scheduler will take care of loading all the CPUs just fine by itself.
</p>
<p>
A bit of warning, though: when Prime95 says "lots of RAM tested", they <i>mean </i> it. We tried running two instances of "Blend" with only 4 gigabytes of memory installed on the server and we nearly crushed the pagefile; both instances allocated nearly 6 gigabytes!
</p>
<p>
<img alt="Prime95 torture test dialog" border="0" class="at-xid-6a0120a85dcdae970b0128776fe48a970c" height="230" src="https://blog.codinghorror.com/content/images/uploads/2006/08/6a0120a85dcdae970b0128776fe48a970c-pi.png" width="504">
</p>
<p>
In my experience, Prime95 will error out almost immediately if your CPUs or memory are unstable. This is great for troubleshooting because you know quickly if there's a problem or not. If you can run Prime95 "small FFTs" for an hour, it's highly likely that the CPU isn't your problem. And if you can run the same test overnight, CPU problems can be definitively ruled out.
</p>
<p>
In the case of our wayward server, Memtest86+ showed us rare, intermittent memory problems. But Prime95 consistently failed almost immediately when running the "blend" test. When we switched Prime95 to "small FFTs", it ran two instances for an hour just fine. Clearly a memory issue! Using a combination of Memtest86+ and Prime95, we found that <b>our server was totally stable with 4 gigabytes of memory installed</b>; the minute we put in all 8 gigabytes, we couldn't pass one or both tests.
</p>
<p>
Since 8 gigabytes of memory is essential for a VM server, removing memory wasn't an option. On a hunch, I switched the memory speed from 200 MHz to 166 MHz in the BIOS. Now both Prime95 blend and Memtest86+ pass without incident.
</p>
<p>
Although software is notoriously unreliable, we can't always blame the software. <b>Sometimes you really do have a hardware problem</b>.
</p>
<p>
* CPUs are almost never defective; it's usually a heat or power supply related failure.
</p>
<p>
</p>
<p></p>
<!--kg-card-end: markdown-->
            </content>
<pubDate>2006-08-11T12:00:00.000Z</pubDate>
<guid>https://blog.codinghorror.com/sometimes-its-a-hardware-problem/</guid>
</item>
</channel>
</rss>
