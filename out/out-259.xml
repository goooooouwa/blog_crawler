<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
<channel>
<title>Coding Horror</title>
<description>programming and human factors</description>
<link>https://blog.codinghorror.com/</link>
<pubDate>Sun, 19 Apr 2020 00:00:01 GMT</pubDate>
<!-- other elements omitted from this example -->
<item>
<title>Rate Limiting and Velocity Checking</title>
<link>https://blog.codinghorror.com/rate-limiting-and-velocity-checking/</link>
<content>
                <!--kg-card-begin: markdown--><p>
Lately, I've been seeing these <b>odd little signs</b> pop up in storefronts around town.
</p>
<p>
<img alt="7-11 rate limiter" border="0" class="at-xid-6a0120a85dcdae970b012877708014970c" height="450" src="https://blog.codinghorror.com/content/images/uploads/2009/02/6a0120a85dcdae970b012877708014970c-pi.jpg" width="600">
</p>
<p>
All the signs have various forms of this printed on them:
</p>
<p>
</p>
<blockquote>
Only <u>3</u> students at a time in the store please
</blockquote>
<p>
We took that picture at a 7-11 convenience store which happens to be near a high school, so maybe the problem is particularly acute there. But even farther into town, the same signs appear with disturbing regularity. I'm guessing the store owners must consider these rules necessary because:
</p>
<p>
</p>
<ul>
<li>teenage students are more likely to shoplift than most customers
</li>
<li>with many teenage students in the store, it's difficult for the owners to keep an eye on everyone, which further increases the likelihood of shoplifting.
</li>
</ul>
<p>
I'm just guessing; I don't own a store. But like the "no elephants" sign, it must be there to <a href="http://www.joelonsoftware.com/uibook/chapters/fog0000000059.html">address a real problem</a>.
</p>
<p>
</p>
<blockquote>
When you go into a restaurant and see a sign that says "No Dogs Allowed," you might think that sign is purely proscriptive: Mr. Restaurant doesn't like dogs around, so when he built the restaurant he put up that sign. If that was all that was going on, there would also be a "No Snakes" sign; after all, nobody likes snakes. And a "No Elephants" sign, because they break the chairs when they sit down. The real reason that sign is there is historical: it is a historical marker that indicates that people used to try to bring their dogs into the restaurant
</blockquote>
<p>
All these signs are enough to make me <b>question the ethics of high school students in groups of 3 or more</b>. Although, to be fair, I've seen some really shifty looking graduate students in my day.
</p>
<p>
In truth, these kinds of limits are <i>everywhere</i>; they're just not as obvious because there's often no signage trail to follow.
</p>
<p>
</p>
<ul>
<li>Most ATMs only allow you to withdraw $300 cash maximum in one day.
</li>
<li>Free email accounts typically limit how many emails can be sent per day.
</li>
<li>Internet providers limit individual download and upload speeds to ensure they aren't overselling their bandwidth.
</li>
<li>There's a maximum on how many Xbox Live Points you can add to your account per day. (<a href="http://en.wikipedia.org/wiki/Downloadable_content_in_Rock_Band">All 500+ Rock Band songs</a> aren't going to download themselves, after all.)
</li>
</ul>
<p>
I'm sure you can think of lots of other real world examples. They're all around you.
</p>
<p>
There are people who act like groups of rampaging teenage students online, too, and we deal with them in the same way: by <b>imposing rate limits!</b> Consider how <a href="http://googleonlinesecurity.blogspot.com/2007/07/reason-behind-were-sorry-message.html">Google limits any IP address that's submitting "too many" search requests</a>:
</p>
<p>
</p>
<blockquote>
Several things can trigger the sorry message.
<p>
<img alt="google error: we're sorry, search rate limiter with captcha" border="0" class="at-xid-6a0120a85dcdae970b012877708028970c" height="541" src="https://blog.codinghorror.com/content/images/uploads/2009/02/6a0120a85dcdae970b012877708028970c-pi.png" width="450">
</p>
<p>
Often it's due to infected computers or DSL routers that proxy search traffic through your network - this may be at home or even at a workplace where one or more computers might be infected. Overly aggressive SEO ranking tools may trigger this message, too. In other cases, we have seen self-propagating worms that use Google search to identify vulnerable web servers on the Internet and then exploit them. The exploited systems in turn then search Google for more vulnerable web servers and so on.  This can lead to a noticeable increase in search queries and <i>sorry</i> is one of our mechanisms to deal with this.
</p>
</blockquote>
<p>
I did <a href="http://www.codinghorror.com/blog/archives/001186.html">a bit of Google scraping</a> once for a small research project, but I never ran into the CAPTCHA limiter. I think that entry predates its appearance. But it does make you wonder what typical search volumes are, and how they're calculated. <b>Determining how much is "too much" -- that's the art of rate limiting</b>. It's a tricky thing, even for the store owner:
</p>
<p>
</p>
<ul>
<li>Couldn't three morally bankrupt students shoplift just as effectively as four?
</li>
<li>How do you tell who is a student? Is it based purely on perception of age?
</li>
<li>Do we expect this rule to be self-enforcing? Will the fourth student walk into the store, identify three other students, and then decide to leave?
</li>
</ul>
<p>
Rate limiting isn't always a precise science. But it's <i>necessary</i>, even with the false positives -- consider <a href="http://www.codinghorror.com/blog/archives/001206.html">how dangerous a login entry with no limits on failed attempts</a> could be. This is especially true once your code is connected to the internet. Human students can be a problem, but there's a practical limit to how many students can fit in a store, and how fast they can physically shoplift your inventory. But <b>what if those "students" were an infinite number of computer programs, capable of stealing items from your web store at a rate only limited by network bandwidth?</b> Your store would be picked clean in a matter of minutes. Maybe even seconds!
</p>
<p>
Not having any sort of rate limiting in your web application is an open invitation to abuse. Even the most innocuous of user actions, if done rapidly enough and by enough users, could have potentially disastrous effects.
</p>
<p>
Even after you've instituted a rate limit, you can still get in trouble. On Stack Overflow, we <a href="http://www.codinghorror.com/blog/archives/001123.html">designed for evil</a>. We have a Google-style rate limiting CAPTCHA in place, along with a variety of other bot defeating techniques. They'be been working well so far. But what we failed to consider was that a determined (and apparently ultra-bored) <i>human</i> user could sit there and <a href="http://blog.stackoverflow.com/2009/02/new-question-answer-rate-limits/">solve CAPTCHAs as fast as possible to spam the site</a>.
</p>
<p>
And thus was born a new user based limit. I suppose we could create a little sign and hang it outside our virtual storefront:
</p>
<p>
</p>
<blockquote>
Only 1 question per new user every 10 minutes, please.
</blockquote>
<p>
There are a few classes of rate limiting or velocity checking you can do:
</p>
<p>
</p>
<ol>
<li>
<b>Per user or API key</b>. Ensure that any given user account or API account key holder can only perform (n) actions per minute. This is usally fairly safe, though it won't protect you from a user who automates the creation of 100 puppet accounts to do their bidding. It all depends how strictly you tie identity to the API key or user; you can easily ban, or in the worst case, track down the culprits and ask them to desist.
<br><br>
</li>
<li>
<b>Per IP address</b>. Ensure that any given IP address can only perform (n) actions per minute. This works well in the typical case, but can cause problems for multiple users who happen to be behind a proxy that makes them appear to you as the "same" IP address. This is the only method possible on mostly anonymous sites like Craigslist, and it definitely works, because <a href="http://www.codinghorror.com/craigslist/">I've been on the receiving end of it</a>. Example implementations are <a href="http://www.zdziarski.com/projects/mod_evasive/">mod_evasive</a> for Apache, or the <a href="http://learn.iis.net/page.aspx/548/using-dynamic-ip-restrictions/">IIS7 Dynamic IP Restriction module</a>.
<br><br>
</li>
<li>
<b>Per global action</b>. Ensure that a particular action can only happen (n) times per minute. Kind of the nuclear option, so obviously must be used with care. Can make sense for the "big red launch button" administrator functions which should be extraordinarily rare -- until a malicious user happens to gain administrator rights and starts pushing that big red button over and over.
</li>
</ol>
<p>
I was shocked how little comprehensive information was out there on rate limiting and velocity checking for software developers, because <b>they are your first and most important line of defense against a broad spectrum of possible attacks</b>. It's amazing how many attacks you can mitigate or even <i>defeat</i> by instituting basic rate limiting.
</p>
<p>
Take a long, hard look your own website -- how would it deal with a roving band of bored, morally ambiguous schoolkids?
</p>
<p>
</p>
<p></p>
<!--kg-card-end: markdown-->
            </content>
<pubDate>2009-02-23T12:00:00.000Z</pubDate>
<guid>https://blog.codinghorror.com/rate-limiting-and-velocity-checking/</guid>
</item>
</channel>
</rss>
