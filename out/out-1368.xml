<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
<channel>
<title>Coding Horror</title>
<description>programming and human factors</description>
<link>https://blog.codinghorror.com/</link>
<pubDate>Sun, 19 Apr 2020 00:00:01 GMT</pubDate>
<!-- other elements omitted from this example -->
<item>
<title>Net.WebClient and GZip</title>
<link>https://blog.codinghorror.com/netwebclient-and-gzip/</link>
<content>
                <!--kg-card-begin: markdown--><p>
The Net.WebClient class doesn't support HTTP compression, eg, when you add the <b>Accept-Encoding: gzip,deflate</b> header to your request:
</p>
<p>
</p>
<pre language="vb" name="code">
Dim wc As New Net.WebClient
'-- google will not gzip the content if the User-Agent header is missing!
wc.Headers.Add("User-Agent", strHttpUserAgent)
wc.Headers.Add("Accept-Encoding", "gzip,deflate")
'-- download the target URL into a byte array
Dim b() As Byte = wc.DownloadData(strUrl)
</pre>
<p>
What you get is a gzipped array of bytes. It's pretty easy to add the missing gzip support, though. First, download the <a href="http://www.icsharpcode.net/OpenSource/SharpZipLib/Default.aspx%22">SharpZipLib</a> and add a reference to <b>ICSharpCode.SharpZipLib</b> to your project. Then it's only a few more lines of code..
</p>
<p>
</p>
<pre language="vb" name="code">
Dim gz As New GZip.GZipInputStream(New MemoryStream(b))
Dim intSizeRead As Integer
Dim unzipBytes(intChunkSize) As Byte
Dim OutputStream As New MemoryStream
While True
'-- this decompresses a chunk
'-- remember the output will be larger than the input (one would hope)
intSizeRead = gz.Read(unzipBytes, 0, intChunkSize)
If intSizeRead &gt; 0 Then
OutputStream.Write(unzipBytes, 0, intSizeRead)
Else
Exit While
End If
End While
'-- convert our decompressed bytestream into a UTF-8 string
Return System.Text.Encoding.UTF8.GetString(OutputStream.ToArray)
</pre>
<p>
And voila, the bandwidth, you have saved eet! How do I know this actually works? Using my network sniffer of course..
</p>
<p>
</p>
<p></p>
<!--kg-card-end: markdown-->
            </content>
<pubDate>2004-08-27T12:00:00.000Z</pubDate>
<guid>https://blog.codinghorror.com/netwebclient-and-gzip/</guid>
</item>
</channel>
</rss>
